(function(e){e.fn.threedPages=function(t){var n={pageSelector:".page",pagesPerRow:3};var r=this,t=e.extend(n,t),i=e(window),s="",o;return this.each(function(){var n=e(this),u;r._updatePageTranslations=function(){e.each(u,function(n,r){var i=e(r).removeClass("inactive active"),s=n%t.pagesPerRow,o=Math.floor(n/t.pagesPerRow),a=(s-Math.min(u.length-1,t.pagesPerRow-1)/2)*(i.width()/t.pagesPerRow);offsetTop=(o-1)*(i.height()/t.pagesPerRow);i.css({"-webkit-transform":"translate3d("+a+"px,"+offsetTop+"px, 0px) scale(0.2)",position:"absolute"})})};r._attachEvents=function(){e.each(u,function(t,n){var a=e(n);a.click(function(){if(!a.hasClass("active")){u.addClass("inactive");a.css({"-webkit-transform":"translate3d(0px,0px,1px) scale(1) rotateX(-360deg)"}).removeClass("inactive").addClass("active").prepend('<button class="close">Back</button>');o=a.find("button.close");o.click(function(){i[0].history.back()});window.location.hash=s="#/"+a.attr("id");r._place(window.location.hash)}})})};r._place=function(e){if(e){e=e.replace(/\//g,"")}else if(o){o.remove()}u=r._getChildrenFromHash(e);r._updatePageTranslations();r._attachEvents()};r._getChildrenFromHash=function(e){if(!e){return n.children(t.pageSelector)}return n.find(e).children(t.pageSelector)};window.addEventListener("hashchange",function(){if(window.location.hash!==s){r._place(window.location.hash===""?undefined:window.location.hash)}},false);r._place()})}})(jQuery)